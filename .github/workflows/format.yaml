name: Format Check

on:
    push:
        branches:
            - main
            - develop
    pull_request:
        branches:
            - main
            - develop
    workflow_dispatch:

# Cancel in-progress runs for the same PR/branch
concurrency:
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: true

jobs:
    format-check:
        name: clang-format (${{ matrix.path }})
        runs-on: ubuntu-latest
        strategy:
            fail-fast: false
            matrix:
                path:
                    - "src"
                    - "tests"
                    - "examples"
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4
              with:
                  submodules: recursive

            - name: Run clang-format style check
              uses: jidicula/clang-format-action@v4.16.0
              with:
                  clang-format-version: "21"
                  check-path: ${{ matrix.path }}
                  exclude-regex: "(third-party)"
